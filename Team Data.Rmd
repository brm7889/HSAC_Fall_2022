---
title: "Team Data"
output: html_document
---

```{r}
library(tidyverse)
HSAC_MLB_payroll_data <- read_csv("HSAC - MLB payroll data.csv")

HSAC_MLB_payroll_data$`Total Payroll` <- sub('.', '', HSAC_MLB_payroll_data$`Total Payroll`)
HSAC_MLB_payroll_data$`Total Payroll` <- as.integer(gsub(',', '', HSAC_MLB_payroll_data$`Total Payroll`))

plot(HSAC_MLB_payroll_data$`Total Payroll`, HSAC_MLB_payroll_data$`Win %`)
summary(lm(HSAC_MLB_payroll_data$`Win %`~HSAC_MLB_payroll_data$`Total Payroll`))
plot(HSAC_MLB_payroll_data$`Total Payroll`, HSAC_MLB_payroll_data$`Win %`)
cor(HSAC_MLB_payroll_data$`Total Payroll`, HSAC_MLB_payroll_data$`Win %`, use="pairwise.complete.obs")

cor(HSAC_MLB_payroll_data$Rank, HSAC_MLB_payroll_data$`Win %`, use="pairwise.complete.obs")



```

```{r}
mlb_players <- read_csv("MLB Player Salaries 10-24.csv")

mlb_players$`Adj. Salary` <- gsub('\\$', '', mlb_players$`Adj. Salary`)
mlb_players$`Adj. Salary` <- gsub(',', '', mlb_players$`Adj. Salary`)
mlb_players$`Adj. Salary` <- gsub('-', '0', mlb_players$`Adj. Salary`)

mlb_players$`Adj. Salary`<- as.integer(mlb_players$`Adj. Salary`)

team_sums <- mlb_players %>% 
  group_by(Team, Year) %>%
  summarise(total_salary=sum(`Adj. Salary`))


HSAC_MLB_payroll_data$Team <- gsub("St. Louis Cardinals", "St Louis Cardinals", HSAC_MLB_payroll_data$Team)
HSAC_MLB_payroll_data$Team <- gsub("Cleveland Indians", "Cleveland Guardians", HSAC_MLB_payroll_data$Team)
HSAC_MLB_payroll_data$Team <- gsub("Florida Marlins", "Miami Marlins", HSAC_MLB_payroll_data$Team)


sums_sums <- merge(team_sums, HSAC_MLB_payroll_data, by = c("Team", "Year"), all = TRUE)

plot(sums_sums$total_salary, sums_sums$`Total Payroll`)
sums_sums$diff <- sums_sums$`Total Payroll` - sums_sums$total_salary

#sums_sums <- sums_sums[-c(169), ]
hist(sums_sums$diff)
plot(sums_sums$total_salary, sums_sums$`Total Payroll`)

mlb_players$hhi_i <- 0

for(i in 1:31297) {
  team <- mlb_players[[i, 14]]
  year <- mlb_players[[i, 13]]
  mlb_players[i, 17] <- (mlb_players[[i, 10]] / team_sums[team_sums$Team == team & team_sums$Year == year, 3]) ^ 2
  
}

hhi_sums <- mlb_players %>% 
  group_by(Team, Year) %>%
  summarise(hhi=sum(hhi_i))

write.csv(hhi_sums, "hhi")
write.csv(HSAC_MLB_payroll_data, "test")

hhi_sums_w <- merge(hhi_sums, HSAC_MLB_payroll_data[, c(1,3,4)], by = c("Team", "Year"), all=TRUE) 

# WILL FIX: Remove marlins 2011
hhi_sums_w <- hhi_sums_w[-c(169),]

plot(hhi_sums_w$hhi, hhi_sums_w$`Win %`)
abline(lm(`Win %` ~ hhi, data=hhi_sums_w))
summary(lm(`Win %` ~ hhi, data=hhi_sums_w))
```

